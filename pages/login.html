<div class="row my-2 mx-2 justify-content-center">
    <div class="col-md-4">
        <form>
            <div class="row justify-content-center my-3">
                <h2>Sign in</h2>
            </div>
            <div class="form-group">
                <input class="form-control" type="text" id="inputUsername"  placeholder="Username" name="username" required autofocus>
            </div>
            <div class="form-group">
                <input class="form-control" type="password" id="inputPassword"  placeholder="Password" name="password" required>    
            </div>              
            
            <button class="btn btn-primary block" type="button" onclick="signInButton(event)">Sign in</button>
    
        </form>
    </div>
</div>


<script type="module">
    import { goToPage } from "./js/utils.js"
    window.signInButton = function(event) {
    
        var authenticationData = {
            Username : document.getElementById("inputUsername").value,
            Password : document.getElementById("inputPassword").value,
        };
        
        var authenticationDetails = new AmazonCognitoIdentity.AuthenticationDetails(authenticationData);
        
        var poolData = {
            UserPoolId : _config.cognito.userPoolId, // Your user pool id here
            ClientId : _config.cognito.clientId, // Your client id here
        };
        
        var userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);
        
        var userData = {
            Username : document.getElementById("inputUsername").value,
            Pool : userPool,
        };
        
        var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);
        event.preventDefault(); // prevent page from refreshing before authentication is completed, causing network errors
        cognitoUser.authenticateUser(authenticationDetails, {
            onSuccess: async function (result) {
                var accessToken = result.getAccessToken().getJwtToken();
                console.log(accessToken);	
                console.log("User authenticated. Logging in...")
                logout_link.style.display = "block"; 
                const nav = await goToPage("select-bus");
            },

            onFailure: function(err) {
                alert(err.message || JSON.stringify(err));
            },
        });
    }
    console.log("Loaded login page")
</script>
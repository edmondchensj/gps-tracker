<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <!-- Packages -->
    <link rel='stylesheet' type='text/css' href="./lib/bootstrap.min.css">
    <link rel='stylesheet' type='text/css' href="./css/style.css">
    <link rel='stylesheet' type='text/css' href="./lib/leaflet-1.6.0/leaflet.css">
    
    <!-- Home screen icons, prepared using https://pixelied.com/ and https://favicon.io/-->
    <link rel="apple-touch-icon" href="./assets/favicon/apple-touch-icon.png">
    <link rel="shortcut icon" href="./assets/favicon/favicon.ico">
    <link rel="manifest" href="./assets/favicon/site.webmanifest">

    <title>GPS Tracker</title>
</head>

<body>
    <div class="container my-3">
        <div class="font-weight-light text-center">Simple GPS TRACKER</div>

        <div id="main">
            <div class="row px-2 justify-content-center mt-4">
                <div class="spinner-border mt-2 text-black-50" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
            </div>
        </div>
    </div>
</body>

<script src="./lib/jquery.min.js"></script>

<!-- Amazon Cognito for Authentication -->
<script src="./lib/aws-sdk-2.7.16.min.js"></script> 
<script src="./lib/aws-cognito/amazon-cognito-auth.min.js"></script>  
<script src="./config.js"></script>
<script src="./lib/aws-cognito/amazon-cognito-identity.min.js"></script>

<!-- Run validation for user session -->
<script type="module">
    // Call Cognito to validate user session
    console.log("Running Cognito user session validation")
    import { validateCognitoUser } from "./js/auth.js"
    import { setInnerHTMLWithJS } from "./js/utils.js"

    const success = validateCognitoUser();
    console.log("Cognito user validation success: ", success);
    var page = ""

    if (!success) {
        console.log("Cognito user invalid, redirecting to login");
        // Redirect to login.html if user session is null or invalid
        page = "/pages/login.html"
    } else {
        // Redirect to home screen if valid
        //page = "/pages/home-screen.html" 
        page = "/pages/select-bus.html"  //somehow home-screen works but this doesnt
    }

    // Get page
    const html = await fetch(page).then((data) => data.text());
    const main = document.getElementById("main")
    setInnerHTMLWithJS(main, html);
</script>

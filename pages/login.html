<div class="row my-2 mx-2 justify-content-center">
    <div class="col-md-4">
        <form>
            <div class="row justify-content-center my-3">
                <h2>Sign in</h2>
            </div>
            <div class="form-group">
                <input class="form-control" type="text" id="inputUsername"  placeholder="Username" name="username" required autofocus>
            </div>
            <div class="form-group">
                <input class="form-control" type="password" id="inputPassword"  placeholder="Password" name="password" required>    
            </div>              
            
            <button class="btn btn-primary block" type="button" onclick="signInButton(event)">Sign in</button>
    
        </form>
    </div>
</div>


<script type="module">
    import { goToPage } from "./js/utils.js"
    window.signInButton = function(event) {
    
        var authenticationData = {
            Username : document.getElementById("inputUsername").value,
            Password : document.getElementById("inputPassword").value,
        };
        
        var authenticationDetails = new AmazonCognitoIdentity.AuthenticationDetails(authenticationData);
        
        var poolData = {
            UserPoolId : _config.cognito.userPoolId, // Your user pool id here
            ClientId : _config.cognito.clientId, // Your client id here
        };
        
        var userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);
        
        var userData = {
            Username : document.getElementById("inputUsername").value,
            Pool : userPool,
        };
        
        var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);
        event.preventDefault(); // prevent page from refreshing before authentication is completed, causing network errors
        cognitoUser.authenticateUser(authenticationDetails, {
            onSuccess: async function (result) {
                var accessToken = result.getAccessToken().getJwtToken();
                // const credentials = new AWS.CognitoIdentityCredentials({
                //     IdentityPoolId: _config.cognito.identityPoolId,
                //     Logins : {
                //         'cognito-idp.ap-southeast-1.amazonaws.com/ap-southeast-1_f78ln7RZL': result.getIdToken().getJwtToken()
                //     },
                //     region: 'ap-southeast-1'
                // });
                // Initialize the Amazon Cognito credentials provider
                AWS.config.region = 'ap-southeast-1'; // Region
                AWS.config.credentials = new AWS.CognitoIdentityCredentials({
                    IdentityPoolId: 'ap-southeast-1:2c9e16dd-378c-4066-aa44-e3501e3581e0',
                });
                console.log("Cognito Identity Creds: ", AWS.config.region, AWS.config.credentials);
                console.log(accessToken);	
                console.log("User authenticated. Logging in...")
                const nav = await goToPage("select-bus");
                const logout_link = document.getElementById("logout");
                logout_link.style.display = "block"; 
            },

            onFailure: function(err) {
                alert(err.message || JSON.stringify(err));
            },
        });
    }
    console.log("Loaded login page")
</script>